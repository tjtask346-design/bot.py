<!DOCTYPE html>
<html lang="En">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AiM Space - Crypto Wallet</title> 
  <meta name="theme-color" content="#22d3ee" />
  <meta name="description" content="P2P Wallet Application" /> 
  <link rel="manifest" href="/manifest.json">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

  <style>
    body { 
        font-family: 'Poppins', sans-serif; 
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: #e2e8f0;
        min-height: 100vh;
    }
    
    .glass-card { 
        background: rgba(30, 41, 59, 0.6); 
        backdrop-filter: blur(12px); 
        -webkit-backdrop-filter: blur(12px); 
        border: 1px solid rgba(255, 255, 255, 0.1); 
        border-radius: 1.5rem; 
    }
    
    .input-field { 
        background-color: #1e293b; 
        border: 1px solid #334155; 
        border-radius: 0.75rem; 
        padding: 0.75rem 1rem; 
        color: white; 
        transition: all 0.3s ease; 
    }
    
    .input-field:focus { 
        outline: none; 
        border-color: #22d3ee;
        box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.1);
    }
    
    .btn-primary { 
        background: linear-gradient(90deg, #22d3ee, #06b6d4); 
        border-radius: 0.75rem; 
        padding: 0.8rem 1.5rem; 
        font-weight: 600; 
        color: #0f172a; 
        transition: all 0.3s ease; 
        box-shadow: 0 4px 20px rgba(34, 211, 238, 0.3); 
        border: none;
    }
    
    .btn-primary:hover { 
        transform: translateY(-2px); 
        box-shadow: 0 6px 25px rgba(34, 211, 238, 0.4);
    }

    .mode-btn {
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.75rem;
        padding: 0.75rem 1rem;
        color: #e2e8f0;
        transition: all 0.3s ease;
        flex: 1;
    }

    .mode-btn.active {
        background: linear-gradient(90deg, #22d3ee, #06b6d4);
        color: #0f172a;
        font-weight: 600;
    }

    .hidden-email {
        -webkit-text-security: disc;
        text-security: disc;
        letter-spacing: 2px;
    }

    .network-modal {
        background: rgba(30, 41, 59, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
        animation: fadeIn 0.5s ease-out;
    }

    .loading {
      opacity: 0.7;
      pointer-events: none;
    }
  </style>
</head>

<body class="min-h-screen">
  <header class="fixed top-0 left-0 right-0 z-40 bg-slate-900/80 backdrop-blur-lg border-b border-slate-700/50">
    <div class="container mx-auto px-4 py-3">
      <div class="flex justify-between items-center">
        <div class="flex items-center gap-3">
          <img src="1000066307.jpg" alt="AiM Space Logo" class="w-10 h-10 rounded-xl object-cover">
          <div>
            <h1 class="text-xl font-bold text-white">AiM Space</h1>
            <p class="text-xs text-slate-400">P2P Wallet</p>
          </div>
        </div>
        
        <button id="mobileMenuBtn" class="md:flex items-center gap-2 bg-slate-800/50 hover:bg-slate-700/50 px-4 py-2 rounded-lg transition-colors hidden">
          <i class="fas fa-bars text-cyan-400"></i>
          <span class="text-sm text-white">Menu</span>
        </button>
      </div>
    </div>
  </header>

  <div class="pt-20 pb-6">
    <!-- Auth Page -->
    <main id="authPage" class="p-6 max-w-md mx-auto fade-in">
      <div class="text-center mb-8">
        <img src="1000066307.jpg" alt="AiM Space Logo" class="w-20 h-20 rounded-2xl mx-auto mb-4 object-cover">
        <h1 class="text-4xl font-bold text-white mb-2">AiM Space</h1>
        <p class="text-slate-400">Your Secure P2P Wallet</p>
      </div>
      
      <section id="loginSection">
        <div class="glass-card p-6">
          <h2 class="text-2xl font-bold text-white mb-6 text-center">Sign In</h2>
          <form id="loginForm" class="space-y-4">
            <div>
              <label for="loginEmail" class="block text-sm font-medium text-slate-300 mb-2">Email Address</label>
              <input type="email" id="loginEmail" class="w-full input-field" placeholder="Enter your email" required>
            </div>
            
            <div>
              <label for="loginPassword" class="block text-sm font-medium text-slate-300 mb-2">Password</label>
              <div class="relative">
                <input type="password" id="loginPassword" class="w-full input-field pr-10" placeholder="Enter your password" required>
                <button type="button" class="toggle-password absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-cyan-400 transition-colors">
                  <ion-icon name="eye-outline"></ion-icon>
                </button>
              </div>
            </div>
            
            <button type="submit" class="w-full btn-primary mt-2" id="loginBtn">
              <span class="btn-text">Sign In</span>
              <div class="btn-loading hidden">
                <i class="fas fa-spinner fa-spin mr-2"></i> Signing In...
              </div>
            </button>
          </form>
          
          <div class="mt-6 text-center">
            <p class="text-slate-400">Don't have an account? 
              <a href="#" id="showSignUpBtn" class="text-cyan-400 hover:text-cyan-300 transition-colors font-medium">Sign Up</a>
            </p>
          </div>
        </div>
      </section>
      
      <section id="signUpSection" class="hidden">
        <div class="glass-card p-6">
          <h2 class="text-2xl font-bold text-white mb-6 text-center">Create Account</h2>
          <form id="signUpForm" class="space-y-4">
            <div>
              <label for="suEmail" class="block text-sm font-medium text-slate-300 mb-2">Email Address</label>
              <input type="email" id="suEmail" class="w-full input-field" placeholder="Enter your email" required>
            </div>
            
            <div>
              <label for="suPassword" class="block text-sm font-medium text-slate-300 mb-2">Password</label>
              <div class="relative">
                <input type="password" id="suPassword" class="w-full input-field pr-10" placeholder="Create a password" required minlength="6">
                <button type="button" class="toggle-password absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-cyan-400 transition-colors">
                  <ion-icon name="eye-outline"></ion-icon>
                </button>
              </div>
            </div>

            <div>
              <label for="suPhone" class="block text-sm font-medium text-slate-300 mb-2">Phone Number</label>
              <input type="tel" id="suPhone" class="w-full input-field" placeholder="Enter your phone number" required>
            </div>
            
            <div>
              <label for="suReferral" class="block text-sm font-medium text-slate-300 mb-2">Referral Code (Optional)</label>
              <input type="text" id="suReferral" class="w-full input-field" placeholder="Enter referral code if any">
            </div>
            
            <!-- New Payment Section -->
            <div class="border-t border-slate-700 pt-4 mt-4">
              <h3 class="text-lg font-bold text-white mb-4 text-center">Payment Verification</h3>
              <p class="text-slate-400 text-sm mb-4 text-center">Send 10 USDT to the BEP-20 address below and provide transaction hash for verification.</p>
              
              <div class="bg-slate-800 p-3 rounded-lg mb-4">
                <p class="text-xs text-slate-400 mb-1">BEP-20 Address:</p>
                <p class="text-sm font-mono text-white break-all">0x742d35Cc6634C0532925a3b8D4B5e1a1C6B6a9c8</p>
              </div>
              
              <div>
                <label for="transactionHash" class="block text-sm font-medium text-slate-300 mb-2">Transaction Hash</label>
                <input type="text" id="transactionHash" class="w-full input-field" placeholder="Enter your transaction hash" required>
              </div>
            </div>
            
            <button type="submit" class="w-full btn-primary mt-2" id="signupBtn">
              <span class="btn-text">Submit for Review</span>
              <div class="btn-loading hidden">
                <i class="fas fa-spinner fa-spin mr-2"></i> Creating Account...
              </div>
            </button>
          </form>
          
          <div class="mt-6 text-center">
            <p class="text-slate-400">Already have an account? 
              <a href="#" id="showLoginBtn" class="text-cyan-400 hover:text-cyan-300 transition-colors font-medium">Sign In</a>
            </p>
          </div>
        </div>
      </section>
    </main>

    <!-- Dashboard Page -->
    <main id="dashboardPage" class="hidden p-6 max-w-md mx-auto fade-in">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-white mb-1">Dashboard</h2>
        <p class="text-slate-400">Welcome back!</p>
      </div>
      
      <div class="glass-card p-5 mb-6">
        <div class="flex justify-between items-center mb-4">
          <span class="text-slate-400">Total Balance</span>
          <button class="text-cyan-400 hover:text-cyan-300 transition-colors" id="toggleBalance">
            <i class="fas fa-eye"></i>
          </button>
        </div>
        <div class="text-3xl font-bold text-white mb-2" id="mainBalance">$0.00</div>
        <div class="flex justify-between text-sm">
          <span class="text-slate-400">Today's Earnings: <span class="text-white" id="todaysEarning">$0.00</span></span>
          <span class="text-slate-400">Referrals: <span class="text-white" id="todaysReferral">0</span></span>
        </div>
      </div>
      
      <div class="grid grid-cols-2 gap-4 mb-6">
        <button id="mainSendBtn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-slate-700/50 transition-colors">
          <div class="w-12 h-12 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center mb-2">
            <i class="fas fa-paper-plane text-white"></i>
          </div>
          <span class="text-white font-medium">Send Money</span>
        </button>
        
        <button id="mainReceiveBtn" class="glass-card p-4 flex flex-col items-center justify-center hover:bg-slate-700/50 transition-colors">
          <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center mb-2">
            <i class="fas fa-download text-white"></i>
          </div>
          <span class="text-white font-medium">Receive Money</span>
        </button>
      </div>

      <!-- Transaction History Section -->
      <div class="glass-card p-5 mb-6">
        <h3 class="text-lg font-bold text-white mb-4">Transaction History</h3>
        <div id="transactionHistory" class="space-y-3">
          <div class="text-center py-8">
            <i class="fas fa-exchange-alt text-slate-600 text-3xl mb-2"></i>
            <p class="text-slate-400">No transactions yet</p>
          </div>
        </div>
      </div>
      
      <div class="glass-card p-5">
        <h3 class="text-lg font-bold text-white mb-4">Quick Stats</h3>
        <div class="space-y-4">
          <div class="flex justify-between items-center">
            <span class="text-slate-400">Total Earnings</span>
            <span class="text-white font-medium" id="totalEarning">$0.00</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-slate-400">Total Referrals</span>
            <span class="text-white font-medium" id="totalReferral">0</span>
          </div>
        </div>
      </div>
    </main>

    <!-- Send Money Page -->
    <main id="depositPage" class="hidden p-6 max-w-md mx-auto fade-in">
      <div class="flex items-center gap-3 mb-6">
        <button data-page="dashboardPage" class="p-2 bg-slate-800/50 hover:bg-slate-700/50 rounded-lg transition-colors">
          <i class="fas fa-arrow-left text-white"></i>
        </button>
        <div>
          <h2 class="text-2xl font-bold text-white">Send Money</h2>
          <p class="text-slate-400">Transfer funds to another user</p>
        </div>
      </div>
      
      <!-- Mode Switcher for Send Page -->
      <div class="flex gap-2 mb-6 p-1 bg-slate-800/50 rounded-lg">
        <button id="inAppSendModeBtn" class="mode-btn active">In App</button>
        <button id="withdrawModeBtn" class="mode-btn">Withdraw</button>
      </div>
      
      <!-- In App Transfer Mode -->
      <div id="inAppSendMode" class="glass-card p-5">
        <form id="sendMoneyForm" class="space-y-4">
          <div>
            <label for="recipientCode" class="block text-sm font-medium text-slate-300 mb-2">Recipient Wallet Code</label>
            <input type="text" id="recipientCode" class="w-full input-field uppercase" placeholder="Enter recipient's 9-digit code" maxlength="9" required>
          </div>
          
          <div>
            <label for="sendAmount" class="block text-sm font-medium text-slate-300 mb-2">Amount (USD)</label>
            <input type="number" id="sendAmount" class="w-full input-field" placeholder="0.00" min="0.01" step="0.01" required>
          </div>
          
          <div>
            <label for="walletPassword" class="block text-sm font-medium text-slate-300 mb-2">Wallet Password (6-digit PIN)</label>
            <input type="password" id="walletPassword" class="w-full input-field" placeholder="Enter your 6-digit PIN" maxlength="6" pattern="\d{6}" required>
          </div>
          
          <button type="submit" class="w-full btn-primary mt-2" id="sendMoneyBtn">
            <span class="btn-text">Send Money</span>
            <div class="btn-loading hidden">
              <i class="fas fa-spinner fa-spin mr-2"></i> Processing...
            </div>
          </button>
        </form>
      </div>

      <!-- Withdraw Mode -->
      <div id="withdrawMode" class="glass-card p-5 hidden">
        <form id="withdrawForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-slate-300 mb-2">Currency</label>
            <input type="text" value="USDT" class="w-full input-field bg-slate-700 cursor-not-allowed" readonly>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-slate-300 mb-2">Choose Network</label>
            <div class="relative">
              <input type="text" id="withdrawNetworkDisplay" class="w-full input-field bg-slate-700 cursor-pointer" placeholder="Select Network" readonly>
              <button type="button" id="withdrawNetworkSelectBtn" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-cyan-400 transition-colors">
                <i class="fas fa-chevron-down"></i>
              </button>
            </div>
          </div>
          
          <div>
            <label for="withdrawAmount" class="block text-sm font-medium text-slate-300 mb-2">Amount (USDT)</label>
            <input type="number" id="withdrawAmount" class="w-full input-field" placeholder="0.00" min="0.01" step="0.01" required>
          </div>
          
          <div>
            <label for="withdrawAddress" class="block text-sm font-medium text-slate-300 mb-2">Your USDT (BEP-20) Address</label>
            <input type="text" id="withdrawAddress" class="w-full input-field" placeholder="Enter your USDT BEP-20 wallet address" required>
          </div>
          
          <div>
            <label for="withdrawPassword" class="block text-sm font-medium text-slate-300 mb-2">Wallet Password (6-digit PIN)</label>
            <input type="password" id="withdrawPassword" class="w-full input-field" placeholder="Enter your 6-digit PIN" maxlength="6" pattern="\d{6}" required>
          </div>
          
          <button type="submit" class="w-full btn-primary mt-2" id="withdrawBtn">
            <span class="btn-text">Submit Withdraw Request</span>
            <div class="btn-loading hidden">
              <i class="fas fa-spinner fa-spin mr-2"></i> Processing...
            </div>
          </button>
        </form>
      </div>
    </main>

    <!-- Receive Money Page -->
    <main id="withdrawPage" class="hidden p-6 max-w-md mx-auto fade-in">
      <div class="flex items-center gap-3 mb-6">
        <button data-page="dashboardPage" class="p-2 bg-slate-800/50 hover:bg-slate-700/50 rounded-lg transition-colors">
          <i class="fas fa-arrow-left text-white"></i>
        </button>
        <div>
          <h2 class="text-2xl font-bold text-white">Receive Money</h2>
          <p class="text-slate-400">Share your wallet code to receive funds</p>
        </div>
      </div>

      <!-- Mode Switcher -->
      <div class="flex gap-2 mb-6 p-1 bg-slate-800/50 rounded-lg">
        <button id="inAppModeBtn" class="mode-btn active">In App</button>
        <button id="depositsModeBtn" class="mode-btn">Deposits</button>
      </div>
      
      <!-- In App Mode -->
      <div id="inAppMode" class="glass-card p-5">
        <div class="text-center mb-6">
          <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-qrcode text-white text-xl"></i>
          </div>
          <h3 class="text-xl font-bold text-white mb-2">Your Wallet Code</h3>
          <p class="text-slate-400 mb-4">Share this code with others to receive money</p>
          
          <div class="bg-slate-800 p-4 rounded-lg mb-4">
            <p id="receiveCodeDisplay" class="text-2xl font-bold text-white tracking-wider font-mono">LOADING</p>
          </div>
          
          <button id="copyReceiveCodeBtn" class="copy-btn w-full btn-primary" data-copytext="">Copy Code</button>
        </div>
      </div>

      <!-- Deposits Mode -->
      <div id="depositsMode" class="glass-card p-5 hidden">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-slate-300 mb-2">Currency</label>
            <input type="text" value="USDT" class="w-full input-field bg-slate-700 cursor-not-allowed" readonly>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-slate-300 mb-2">Choose Network</label>
            <div class="relative">
              <input type="text" id="networkDisplay" class="w-full input-field bg-slate-700 cursor-pointer" placeholder="Select Network" readonly>
              <button id="networkSelectBtn" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-cyan-400 transition-colors">
                <i class="fas fa-chevron-down"></i>
              </button>
            </div>
          </div>
          
          <div>
            <label for="depositAmount" class="block text-sm font-medium text-slate-300 mb-2">Amount (USDT)</label>
            <input type="number" id="depositAmount" class="w-full input-field" placeholder="0.00" min="0.01" step="0.01" required>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-slate-300 mb-2">Wallet Address</label>
            <div class="relative">
              <input type="text" id="walletAddress" class="w-full input-field pr-16 bg-slate-700 cursor-not-allowed" readonly>
              <button id="copyAddressBtn" class="copy-btn absolute right-2 top-1/2 transform -translate-y-1/2 bg-cyan-500 hover:bg-cyan-600 text-white px-3 py-1 rounded text-sm transition-colors">
                Copy
              </button>
            </div>
          </div>
          
          <div>
            <label for="p2pHash" class="block text-sm font-medium text-slate-300 mb-2">Transaction Hash</label>
            <input type="text" id="p2pHash" class="w-full input-field" placeholder="Enter transaction hash" required>
          </div>

          <button id="confirmDepositBtn" class="w-full btn-primary mt-4">
            <span class="btn-text">Confirm Deposit</span>
            <div class="btn-loading hidden">
              <i class="fas fa-spinner fa-spin mr-2"></i> Processing...
            </div>
          </button>
        </div>
      </div>
    </main>

    <!-- Menu Page -->
    <main id="menuPage" class="hidden p-6 max-w-md mx-auto fade-in">
      <div class="flex items-center gap-3 mb-6">
        <button data-page="dashboardPage" class="p-2 bg-slate-800/50 hover:bg-slate-700/50 rounded-lg transition-colors">
          <i class="fas fa-arrow-left text-white"></i>
        </button>
        <div>
          <h2 class="text-2xl font-bold text-white">Menu</h2>
          <p class="text-slate-400">Manage your account and settings</p>
        </div>
      </div>
      
      <div class="glass-card p-5">
        <div class="space-y-4">
          <button data-page="dashboardPage" class="w-full flex items-center gap-4 p-3 rounded-lg hover:bg-slate-700/50 transition-colors text-left">
            <div class="w-10 h-10 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-home text-white"></i>
            </div>
            <div>
              <span class="text-white font-medium block">Dashboard</span>
              <span class="text-slate-400 text-sm">Back to main screen</span>
            </div>
          </button>
          
          <button data-page="depositPage" class="w-full flex items-center gap-4 p-3 rounded-lg hover:bg-slate-700/50 transition-colors text-left">
            <div class="w-10 h-10 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-paper-plane text-white"></i>
            </div>
            <div>
              <span class="text-white font-medium block">Send Money</span>
              <span class="text-slate-400 text-sm">Transfer to other users</span>
            </div>
          </button>
          
          <button data-page="withdrawPage" class="w-full flex items-center gap-4 p-3 rounded-lg hover:bg-slate-700/50 transition-colors text-left">
            <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-download text-white"></i>
            </div>
            <div>
              <span class="text-white font-medium block">Receive Money</span>
              <span class="text-slate-400 text-sm">Get your wallet code</span>
            </div>
          </button>
          
          <!-- New Set Transaction Password Button -->
          <button id="setPasswordBtn" class="w-full flex items-center gap-4 p-3 rounded-lg hover:bg-slate-700/50 transition-colors text-left">
            <div class="w-10 h-10 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-lock text-white"></i>
            </div>
            <div>
              <span class="text-white font-medium block">Set Transaction Password</span>
              <span class="text-slate-400 text-sm">Set/Change your 6-digit PIN</span>
            </div>
          </button>

          <!-- Support Button -->
          <button id="supportBtn" class="w-full flex items-center gap-4 p-3 rounded-lg hover:bg-slate-700/50 transition-colors text-left">
            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-headset text-white"></i>
            </div>
            <div>
              <span class="text-white font-medium block">Support</span>
              <span class="text-slate-400 text-sm">Get help and support</span>
            </div>
          </button>
          
          <button id="referralBtn" class="w-full flex items-center gap-4 p-3 rounded-lg hover:bg-slate-700/50 transition-colors text-left">
            <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-users text-white"></i>
            </div>
            <div>
              <span class="text-white font-medium block">Referral Program</span>
              <span class="text-slate-400 text-sm">Earn with friends</span>
            </div>
          </button>
          
          <button id="logoutBtn" class="w-full flex items-center gap-4 p-3 rounded-lg hover:bg-slate-700/50 transition-colors text-left">
            <div class="w-10 h-10 bg-gradient-to-r from-red-500 to-pink-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-sign-out-alt text-white"></i>
            </div>
            <div>
              <span class="text-white font-medium block">Logout</span>
              <span class="text-slate-400 text-sm">Sign out of your account</span>
            </div>
          </button>
        </div>
      </div>
    </main>

    <!-- Modals -->
    <div id="alertModal" class="modal-container hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
      <div class="bg-slate-800 rounded-2xl p-6 max-w-sm w-full mx-4 glass-card">
        <div class="text-center">
          <div id="alertIcon" class="fas fa-info-circle text-cyan-400 text-4xl mb-4"></div>
          <h3 id="alertTitle" class="text-xl font-bold text-white mb-2">Alert Title</h3>
          <p id="alertMsg" class="text-slate-400 mb-6">Alert message goes here.</p>
          <button class="close-modal w-full btn-primary">OK</button>
        </div>
      </div>
    </div>

    <div id="referralModal" class="modal-container hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
      <div class="bg-slate-800 rounded-2xl p-6 max-w-sm w-full mx-4 glass-card">
        <div class="text-center">
          <div class="fas fa-users text-purple-400 text-4xl mb-4"></div>
          <h3 class="text-xl font-bold text-white mb-2">Referral Program</h3>
          <p class="text-slate-400 mb-4">Share your code and earn $6 for each friend!</p>
          
          <div class="bg-slate-700 p-4 rounded-lg mb-4">
            <p class="text-sm text-slate-400 mb-1">Your Referral Code</p>
            <p id="referralCodeDisplay" class="text-xl font-bold text-white tracking-wider">LOADING</p>
          </div>
          
          <button class="copy-btn w-full btn-primary mb-3" data-copytext="">Copy Referral Code</button>
          <button class="close-modal w-full py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">Close</button>
        </div>
      </div>
    </div>

    <!-- New Set Transaction Password Modal -->
    <div id="passwordModal" class="modal-container hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
      <div class="bg-slate-800 rounded-2xl p-6 max-w-sm w-full mx-4 glass-card">
        <div class="text-center">
          <div class="fas fa-lock text-yellow-400 text-4xl mb-4"></div>
          <h3 class="text-xl font-bold text-white mb-2" id="passwordModalTitle">Set Transaction Password</h3>
          <p class="text-slate-400 mb-4" id="passwordModalDesc">Set your 6-digit PIN for transactions</p>
          
          <form id="passwordForm" class="space-y-4">
            <div id="oldPasswordField" class="hidden">
              <label for="oldWalletPassword" class="block text-sm font-medium text-slate-300 mb-2">Old Password</label>
              <input type="password" id="oldWalletPassword" class="w-full input-field" placeholder="Enter old 6-digit PIN" maxlength="6" pattern="\d{6}">
            </div>
            
            <div>
              <label for="newWalletPassword" class="block text-sm font-medium text-slate-300 mb-2">New Password</label>
              <input type="password" id="newWalletPassword" class="w-full input-field" placeholder="Enter new 6-digit PIN" maxlength="6" pattern="\d{6}" required>
            </div>
            
            <div>
              <label for="confirmWalletPassword" class="block text-sm font-medium text-slate-300 mb-2">Confirm Password</label>
              <input type="password" id="confirmWalletPassword" class="w-full input-field" placeholder="Confirm 6-digit PIN" maxlength="6" pattern="\d{6}" required>
            </div>
            
            <button type="submit" class="w-full btn-primary mt-2" id="setPasswordSubmitBtn">
              <span class="btn-text">Set Password</span>
              <div class="btn-loading hidden">
                <i class="fas fa-spinner fa-spin mr-2"></i> Setting...
              </div>
            </button>
          </form>
          
          <button class="close-modal w-full py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors mt-3">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Deposit Confirmation Modal -->
    <div id="depositConfirmModal" class="modal-container hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
      <div class="bg-slate-800 rounded-2xl p-6 max-w-sm w-full mx-4 glass-card">
        <div class="text-center">
          <div class="fas fa-check-circle text-green-400 text-4xl mb-4"></div>
          <h3 class="text-xl font-bold text-white mb-2">Deposit Submitted</h3>
          <p class="text-slate-400 mb-4">Your deposit request has been submitted for admin approval.</p>
          <button class="close-modal w-full btn-primary">OK</button>
        </div>
      </div>
    </div>

    <!-- Network Selection Modal -->
    <div id="networkModal" class="modal-container hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
      <div class="bg-slate-800 rounded-2xl p-6 max-w-sm w-full mx-4 network-modal">
        <div class="text-center mb-4">
          <h3 class="text-xl font-bold text-white">Select Network</h3>
          <p class="text-slate-400">Choose your preferred network</p>
        </div>
        
        <div class="space-y-3">
          <button class="network-option w-full flex items-center gap-3 p-3 rounded-lg hover:bg-slate-700/50 transition-colors text-left border border-slate-700" data-network="BEP-20">
            <div class="w-10 h-10 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-lg flex items-center justify-center">
              <i class="fab fa-btc text-white"></i>
            </div>
            <div>
              <span class="text-white font-medium block">BEP-20</span>
              <span class="text-slate-400 text-sm">BNB Smart Chain</span>
            </div>
          </button>
          
          <button class="network-option w-full flex items-center gap-3 p-3 rounded-lg hover:bg-slate-700/50 transition-colors text-left border border-slate-700" data-network="TRC-20">
            <div class="w-10 h-10 bg-gradient-to-r from-red-500 to-pink-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-bolt text-white"></i>
            </div>
            <div>
              <span class="text-white font-medium block">TRC-20</span>
              <span class="text-slate-400 text-sm">TRON Network</span>
            </div>
          </button>
        </div>
        
        <button class="close-modal w-full py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors mt-4">Cancel</button>
      </div>
    </div>

    <!-- Support Modal -->
    <div id="supportModal" class="modal-container hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
      <div class="bg-slate-800 rounded-2xl p-6 max-w-sm w-full mx-4 glass-card">
        <div class="text-center">
          <div class="fas fa-headset text-blue-400 text-4xl mb-4"></div>
          <h3 class="text-xl font-bold text-white mb-2">Support</h3>
          <p class="text-slate-400 mb-4">Contact our support team for assistance</p>
          
          <div class="space-y-3 text-left">
            <div class="bg-slate-700 p-3 rounded-lg">
              <p class="text-sm text-slate-400">Email</p>
              <p class="text-white">support@aimspace.com</p>
            </div>
            
            <div class="bg-slate-700 p-3 rounded-lg">
              <p class="text-sm text-slate-400">Telegram</p>
              <p class="text-white">@AiMSpaceSupport</p>
            </div>
            
            <div class="bg-slate-700 p-3 rounded-lg">
              <p class="text-sm text-slate-400">Response Time</p>
              <p class="text-white">24-48 hours</p>
            </div>
          </div>
          
          <button class="close-modal w-full btn-primary mt-4">Close</button>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center hidden">
      <div class="text-center">
        <div class="w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
        <p class="text-white font-medium">Processing...</p>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, where, getDocs, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
  apiKey: "AIzaSyBy5YU4rVzkaM4wPZAwfSdE1gK00vRbHvQ",
  authDomain: "testscmweb1.firebaseapp.com",
  databaseURL: "https://testscmweb1-default-rtdb.firebaseio.com",
  projectId: "testscmweb1",
  storageBucket: "testscmweb1.firebasestorage.app",
  messagingSenderId: "921389692757",
  appId: "1:921389692757:web:d60bcb7c9419ce1c5fe1dc"
};

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Global variables
    let currentUser = null;
    let userData = null;
    let userWalletCode = null;

    // DOM Elements
    const authPage = document.getElementById('authPage');
    const dashboardPage = document.getElementById('dashboardPage');
    const depositPage = document.getElementById('depositPage');
    const withdrawPage = document.getElementById('withdrawPage');
    const menuPage = document.getElementById('menuPage');
    const loginSection = document.getElementById('loginSection');
    const signUpSection = document.getElementById('signUpSection');
    const alertModal = document.getElementById('alertModal');
    const loadingOverlay = document.getElementById('loadingOverlay');

    // Generate unique 9-digit wallet code
    function generateWalletCode() {
      return Math.floor(100000000 + Math.random() * 900000000).toString();
    }

    // Generate referral code
    function generateReferralCode() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let result = '';
      for (let i = 0; i < 8; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    // Show alert modal
    function showAlert(title, message, type = 'info') {
      const icon = document.getElementById('alertIcon');
      const alertTitle = document.getElementById('alertTitle');
      const alertMsg = document.getElementById('alertMsg');
      
      // Set icon based on type
      if (type === 'success') {
        icon.className = 'fas fa-check-circle text-green-400 text-4xl mb-4';
      } else if (type === 'error') {
        icon.className = 'fas fa-exclamation-circle text-red-400 text-4xl mb-4';
      } else if (type === 'warning') {
        icon.className = 'fas fa-exclamation-triangle text-yellow-400 text-4xl mb-4';
      } else {
        icon.className = 'fas fa-info-circle text-cyan-400 text-4xl mb-4';
      }
      
      alertTitle.textContent = title;
      alertMsg.textContent = message;
      alertModal.classList.remove('hidden');
    }

    // Show loading
    function showLoading() {
      loadingOverlay.classList.remove('hidden');
    }

    // Hide loading
    function hideLoading() {
      loadingOverlay.classList.add('hidden');
    }

    // Navigate to page
    function navigateTo(pageId) {
      // Hide all pages
      document.querySelectorAll('main').forEach(page => {
        page.classList.add('hidden');
      });
      
      // Show target page
      document.getElementById(pageId).classList.remove('hidden');
    }

    // Format currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
      }).format(amount);
    }

    // Format date
    function formatDate(date) {
      return new Date(date).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Update dashboard data
    async function updateDashboard() {
      if (!currentUser) return;

      try {
        const userDoc = await getDoc(doc(db, "users", currentUser.uid));
        if (userDoc.exists()) {
          userData = userDoc.data();
          
          // Update balance display
          const mainBalance = document.getElementById('mainBalance');
          const balanceVisible = userData.balanceVisible !== false;
          mainBalance.textContent = balanceVisible ? formatCurrency(userData.balance || 0) : '****';
          
          // Update other stats
          document.getElementById('todaysEarning').textContent = formatCurrency(userData.todaysEarning || 0);
          document.getElementById('todaysReferral').textContent = userData.todaysReferral || 0;
          document.getElementById('totalEarning').textContent = formatCurrency(userData.totalEarning || 0);
          document.getElementById('totalReferral').textContent = userData.totalReferral || 0;
          
          // Update wallet code display
          if (userData.walletCode) {
            userWalletCode = userData.walletCode;
            document.getElementById('receiveCodeDisplay').textContent = userWalletCode;
          }
          
          // Update referral code display
          if (userData.referralCode) {
            document.getElementById('referralCodeDisplay').textContent = userData.referralCode;
          }
          
          // Load transaction history
          loadTransactionHistory();
        }
      } catch (error) {
        console.error("Error updating dashboard:", error);
      }
    }

    // Load transaction history
    async function loadTransactionHistory() {
      if (!currentUser) return;
      
      const transactionHistory = document.getElementById('transactionHistory');
      
      try {
        const q = query(
          collection(db, "transactions"),
          where("userId", "==", currentUser.uid),
          orderBy("timestamp", "desc"),
          limit(10)
        );
        
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
          transactionHistory.innerHTML = `
            <div class="text-center py-8">
              <i class="fas fa-exchange-alt text-slate-600 text-3xl mb-2"></i>
              <p class="text-slate-400">No transactions yet</p>
            </div>
          `;
          return;
        }
        
        let transactionsHtml = '';
        querySnapshot.forEach((doc) => {
          const transaction = doc.data();
          const icon = transaction.type === 'send' ? 'fa-arrow-up' : 'fa-arrow-down';
          const color = transaction.type === 'send' ? 'text-red-400' : 'text-green-400';
          const sign = transaction.type === 'send' ? '-' : '+';
          
          transactionsHtml += `
            <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-lg">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center">
                  <i class="fas ${icon} ${color}"></i>
                </div>
                <div>
                  <p class="text-white font-medium">${transaction.type === 'send' ? 'Sent' : 'Received'}</p>
                  <p class="text-slate-400 text-sm">${formatDate(transaction.timestamp?.toDate())}</p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-white font-medium">${sign}${formatCurrency(transaction.amount)}</p>
                <p class="text-slate-400 text-sm">${transaction.status || 'completed'}</p>
              </div>
            </div>
          `;
        });
        
        transactionHistory.innerHTML = transactionsHtml;
      } catch (error) {
        console.error("Error loading transactions:", error);
        transactionHistory.innerHTML = `
          <div class="text-center py-8">
            <i class="fas fa-exclamation-triangle text-red-400 text-3xl mb-2"></i>
            <p class="text-slate-400">Error loading transactions</p>
          </div>
        `;
      }
    }

    // Process referral bonus
    async function processReferralBonus(referralCode) {
      if (!referralCode) return;
      
      try {
        // Find user with this referral code
        const q = query(collection(db, "users"), where("referralCode", "==", referralCode));
        const querySnapshot = await getDocs(q);
        
        if (!querySnapshot.empty) {
          const referrerDoc = querySnapshot.docs[0];
          const referrerData = referrerDoc.data();
          
          // Add referral bonus to referrer
          await updateDoc(doc(db, "users", referrerDoc.id), {
            totalReferral: (referrerData.totalReferral || 0) + 1,
            todaysReferral: (referrerData.todaysReferral || 0) + 1,
            balance: (referrerData.balance || 0) + 6, // $6 referral bonus
            totalEarning: (referrerData.totalEarning || 0) + 6
          });
          
          // Create referral transaction
          await addDoc(collection(db, "transactions"), {
            userId: referrerDoc.id,
            type: 'referral',
            amount: 6,
            description: 'Referral bonus',
            timestamp: serverTimestamp(),
            status: 'completed'
          });
          
          console.log("Referral bonus processed for:", referrerDoc.id);
        }
      } catch (error) {
        console.error("Error processing referral bonus:", error);
      }
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Toggle password visibility
      document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', function() {
          const input = this.previousElementSibling;
          const icon = this.querySelector('ion-icon');
          
          if (input.type === 'password') {
            input.type = 'text';
            icon.name = 'eye-off-outline';
          } else {
            input.type = 'password';
            icon.name = 'eye-outline';
          }
        });
      });

      // Show/Hide auth sections
      document.getElementById('showSignUpBtn').addEventListener('click', function(e) {
        e.preventDefault();
        loginSection.classList.add('hidden');
        signUpSection.classList.remove('hidden');
      });

      document.getElementById('showLoginBtn').addEventListener('click', function(e) {
        e.preventDefault();
        signUpSection.classList.add('hidden');
        loginSection.classList.remove('hidden');
      });

      // Login form
      document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const loginBtn = document.getElementById('loginBtn');
        
        // Show loading state
        loginBtn.querySelector('.btn-text').classList.add('hidden');
        loginBtn.querySelector('.btn-loading').classList.remove('hidden');
        loginBtn.disabled = true;
        
        try {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          console.log("User signed in:", userCredential.user);
          
          // Check if user is approved
          const userDoc = await getDoc(doc(db, "users", userCredential.user.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            
            if (!userData.approved) {
              showAlert("Account Pending", "Your account is pending admin approval. Please wait for approval.", "warning");
              await signOut(auth);
              return;
            }
          }
          
          showAlert("Success", "Login successful!", "success");
        } catch (error) {
          console.error("Login error:", error);
          let errorMessage = "Login failed. Please try again.";
          
          if (error.code === 'auth/invalid-credential') {
            errorMessage = "Invalid email or password.";
          } else if (error.code === 'auth/user-not-found') {
            errorMessage = "No account found with this email.";
          } else if (error.code === 'auth/wrong-password') {
            errorMessage = "Incorrect password.";
          }
          
          showAlert("Login Error", errorMessage, "error");
        } finally {
          // Reset button state
          loginBtn.querySelector('.btn-text').classList.remove('hidden');
          loginBtn.querySelector('.btn-loading').classList.add('hidden');
          loginBtn.disabled = false;
        }
      });

      // Sign up form
      document.getElementById('signUpForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('suEmail').value;
        const password = document.getElementById('suPassword').value;
        const phone = document.getElementById('suPhone').value;
        const referralCode = document.getElementById('suReferral').value.toUpperCase();
        const transactionHash = document.getElementById('transactionHash').value;
        const signupBtn = document.getElementById('signupBtn');
        
        // Show loading state
        signupBtn.querySelector('.btn-text').classList.add('hidden');
        signupBtn.querySelector('.btn-loading').classList.remove('hidden');
        signupBtn.disabled = true;
        
        try {
          // Create user account
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          const user = userCredential.user;
          
          // Generate wallet and referral codes
          const walletCode = generateWalletCode();
          const userReferralCode = generateReferralCode();
          
          // Create user document
          await setDoc(doc(db, "users", user.uid), {
            email: email,
            phone: phone,
            walletCode: walletCode,
            referralCode: userReferralCode,
            balance: 0,
            todaysEarning: 0,
            todaysReferral: 0,
            totalEarning: 0,
            totalReferral: 0,
            balanceVisible: true,
            approved: false, // Admin approval required
            transactionPassword: null, // Will be set later by user
            registrationHash: transactionHash,
            createdAt: serverTimestamp()
          });
          
          // Process referral if provided
          if (referralCode) {
            await processReferralBonus(referralCode);
          }
          
          showAlert("Success", "Account created successfully! Please wait for admin approval.", "success");
          
          // Reset form
          document.getElementById('signUpForm').reset();
          document.getElementById('showLoginBtn').click();
          
        } catch (error) {
          console.error("Sign up error:", error);
          let errorMessage = "Sign up failed. Please try again.";
          
          if (error.code === 'auth/email-already-in-use') {
            errorMessage = "An account with this email already exists.";
          } else if (error.code === 'auth/weak-password') {
            errorMessage = "Password should be at least 6 characters.";
          } else if (error.code === 'auth/invalid-email') {
            errorMessage = "Invalid email address.";
          }
          
          showAlert("Sign Up Error", errorMessage, "error");
        } finally {
          // Reset button state
          signupBtn.querySelector('.btn-text').classList.remove('hidden');
          signupBtn.querySelector('.btn-loading').classList.add('hidden');
          signupBtn.disabled = false;
        }
      });

      // Navigation buttons
      document.querySelectorAll('button[data-page]').forEach(button => {
        button.addEventListener('click', function() {
          const targetPage = this.getAttribute('data-page');
          navigateTo(targetPage);
        });
      });

      // Send money form
      document.getElementById('sendMoneyForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const recipientCode = document.getElementById('recipientCode').value.toUpperCase();
        const amount = parseFloat(document.getElementById('sendAmount').value);
        const password = document.getElementById('walletPassword').value;
        const sendBtn = document.getElementById('sendMoneyBtn');
        
        // Validate amount
        if (amount <= 0) {
          showAlert("Invalid Amount", "Please enter a valid amount.", "error");
          return;
        }
        
        // Validate password
        if (password.length !== 6 || !/^\d+$/.test(password)) {
          showAlert("Invalid Password", "Please enter a valid 6-digit PIN.", "error");
          return;
        }
        
        // Show loading
        sendBtn.querySelector('.btn-text').classList.add('hidden');
        sendBtn.querySelector('.btn-loading').classList.remove('hidden');
        sendBtn.disabled = true;
        
        try {
          // Verify transaction password
          const userDoc = await getDoc(doc(db, "users", currentUser.uid));
          if (!userDoc.exists()) {
            throw new Error("User data not found");
          }
          
          const userData = userDoc.data();
          
          if (!userData.transactionPassword) {
            showAlert("Password Not Set", "Please set your transaction password first.", "error");
            return;
          }
          
          if (userData.transactionPassword !== password) {
            showAlert("Invalid Password", "Transaction password is incorrect.", "error");
            return;
          }
          
          // Check balance
          if (userData.balance < amount) {
            showAlert("Insufficient Balance", "You don't have enough balance to complete this transaction.", "error");
            return;
          }
          
          // Find recipient
          const q = query(collection(db, "users"), where("walletCode", "==", recipientCode));
          const querySnapshot = await getDocs(q);
          
          if (querySnapshot.empty) {
            showAlert("Recipient Not Found", "No user found with this wallet code.", "error");
            return;
          }
          
          const recipientDoc = querySnapshot.docs[0];
          const recipientData = recipientDoc.data();
          
          if (recipientDoc.id === currentUser.uid) {
            showAlert("Invalid Recipient", "You cannot send money to yourself.", "error");
            return;
          }
          
          // Perform transaction
          const batch = [];
          
          // Deduct from sender
          batch.push(updateDoc(doc(db, "users", currentUser.uid), {
            balance: userData.balance - amount
          }));
          
          // Add to recipient
          batch.push(updateDoc(doc(db, "users", recipientDoc.id), {
            balance: (recipientData.balance || 0) + amount
          }));
          
          // Create transaction records
          const transactionData = {
            amount: amount,
            timestamp: serverTimestamp(),
            status: 'completed'
          };
          
          batch.push(addDoc(collection(db, "transactions"), {
            userId: currentUser.uid,
            type: 'send',
            recipientCode: recipientCode,
            ...transactionData
          }));
          
          batch.push(addDoc(collection(db, "transactions"), {
            userId: recipientDoc.id,
            type: 'receive',
            senderCode: userWalletCode,
            ...transactionData
          }));
          
          // Execute all operations
          await Promise.all(batch);
          
          showAlert("Success", `Successfully sent ${formatCurrency(amount)} to ${recipientCode}`, "success");
          document.getElementById('sendMoneyForm').reset();
          updateDashboard();
          
        } catch (error) {
          console.error("Send money error:", error);
          showAlert("Transaction Failed", "Failed to send money. Please try again.", "error");
        } finally {
          // Reset button state
          sendBtn.querySelector('.btn-text').classList.remove('hidden');
          sendBtn.querySelector('.btn-loading').classList.add('hidden');
          sendBtn.disabled = false;
        }
      });

      // Set transaction password
      document.getElementById('setPasswordBtn').addEventListener('click', function() {
        const userDoc = getDoc(doc(db, "users", currentUser.uid));
        userDoc.then(doc => {
          const userData = doc.data();
          const modalTitle = document.getElementById('passwordModalTitle');
          const modalDesc = document.getElementById('passwordModalDesc');
          const oldPasswordField = document.getElementById('oldPasswordField');
          
          if (userData.transactionPassword) {
            modalTitle.textContent = "Change Transaction Password";
            modalDesc.textContent = "Change your 6-digit PIN for transactions";
            oldPasswordField.classList.remove('hidden');
          } else {
            modalTitle.textContent = "Set Transaction Password";
            modalDesc.textContent = "Set your 6-digit PIN for transactions";
            oldPasswordField.classList.add('hidden');
          }
        });
        
        document.getElementById('passwordModal').classList.remove('hidden');
      });

      // Transaction password form
      document.getElementById('passwordForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const oldPassword = document.getElementById('oldWalletPassword').value;
        const newPassword = document.getElementById('newWalletPassword').value;
        const confirmPassword = document.getElementById('confirmWalletPassword').value;
        const submitBtn = document.getElementById('setPasswordSubmitBtn');
        
        // Validate new password
        if (newPassword.length !== 6 || !/^\d+$/.test(newPassword)) {
          showAlert("Invalid Password", "Password must be exactly 6 digits.", "error");
          return;
        }
        
        if (newPassword !== confirmPassword) {
          showAlert("Password Mismatch", "New password and confirmation do not match.", "error");
          return;
        }
        
        // Show loading
        submitBtn.querySelector('.btn-text').classList.add('hidden');
        submitBtn.querySelector('.btn-loading').classList.remove('hidden');
        submitBtn.disabled = true;
        
        try {
          const userDoc = await getDoc(doc(db, "users", currentUser.uid));
          const userData = userDoc.data();
          
          // If changing password, verify old password
          if (userData.transactionPassword) {
            if (oldPassword !== userData.transactionPassword) {
              showAlert("Invalid Password", "Old password is incorrect.", "error");
              return;
            }
          }
          
          // Update password
          await updateDoc(doc(db, "users", currentUser.uid), {
            transactionPassword: newPassword
          });
          
          showAlert("Success", "Transaction password set successfully!", "success");
          document.getElementById('passwordForm').reset();
          document.getElementById('passwordModal').classList.add('hidden');
          
        } catch (error) {
          console.error("Set password error:", error);
          showAlert("Error", "Failed to set password. Please try again.", "error");
        } finally {
          // Reset button state
          submitBtn.querySelector('.btn-text').classList.remove('hidden');
          submitBtn.querySelector('.btn-loading').classList.add('hidden');
          submitBtn.disabled = false;
        }
      });

      // Toggle balance visibility
      document.getElementById('toggleBalance').addEventListener('click', async function() {
        if (!currentUser) return;
        
        try {
          const userDoc = await getDoc(doc(db, "users", currentUser.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            const newVisibility = !userData.balanceVisible;
            
            await updateDoc(doc(db, "users", currentUser.uid), {
              balanceVisible: newVisibility
            });
            
            updateDashboard();
          }
        } catch (error) {
          console.error("Error toggling balance:", error);
        }
      });

      // Copy buttons
      document.querySelectorAll('.copy-btn').forEach(button => {
        button.addEventListener('click', function() {
          const textToCopy = this.getAttribute('data-copytext') || 
                            this.closest('.glass-card').querySelector('p, input').textContent || 
                            this.closest('.glass-card').querySelector('p, input').value;
          
          navigator.clipboard.writeText(textToCopy).then(() => {
            const originalText = this.textContent;
            this.textContent = 'Copied!';
            this.classList.add('bg-green-500');
            
            setTimeout(() => {
              this.textContent = originalText;
              this.classList.remove('bg-green-500');
            }, 2000);
          });
        });
      });

      // Modal close buttons
      document.querySelectorAll('.close-modal').forEach(button => {
        button.addEventListener('click', function() {
          this.closest('.modal-container').classList.add('hidden');
        });
      });

      // Logout
      document.getElementById('logoutBtn').addEventListener('click', async function() {
        try {
          await signOut(auth);
          showAlert("Logged Out", "You have been successfully logged out.", "success");
          navigateTo('authPage');
        } catch (error) {
          console.error("Logout error:", error);
        }
      });

      // Referral program
      document.getElementById('referralBtn').addEventListener('click', function() {
        document.getElementById('referralModal').classList.remove('hidden');
      });

      // Support
      document.getElementById('supportBtn').addEventListener('click', function() {
        document.getElementById('supportModal').classList.remove('hidden');
      });

      // Network selection
      document.getElementById('networkSelectBtn').addEventListener('click', function() {
        document.getElementById('networkModal').classList.remove('hidden');
      });

      document.getElementById('withdrawNetworkSelectBtn').addEventListener('click', function() {
        document.getElementById('networkModal').classList.remove('hidden');
      });

      // Network options
      document.querySelectorAll('.network-option').forEach(option => {
        option.addEventListener('click', function() {
          const network = this.getAttribute('data-network');
          document.getElementById('networkDisplay').value = network;
          document.getElementById('withdrawNetworkDisplay').value = network;
          
          // Set wallet address based on network
          const walletAddress = document.getElementById('walletAddress');
          if (network === 'BEP-20') {
            walletAddress.value = '0x742d35Cc6634C0532925a3b8D4B5e1a1C6B6a9c8';
          } else if (network === 'TRC-20') {
            walletAddress.value = 'TBa1Y8p7qZi5Q9pL9vK7vR5oR3dJ2XcVwJ';
          }
          
          document.getElementById('networkModal').classList.add('hidden');
        });
      });

      // Mode switchers
      document.getElementById('inAppModeBtn').addEventListener('click', function() {
        document.getElementById('inAppMode').classList.remove('hidden');
        document.getElementById('depositsMode').classList.add('hidden');
        this.classList.add('active');
        document.getElementById('depositsModeBtn').classList.remove('active');
      });

      document.getElementById('depositsModeBtn').addEventListener('click', function() {
        document.getElementById('inAppMode').classList.add('hidden');
        document.getElementById('depositsMode').classList.remove('hidden');
        this.classList.add('active');
        document.getElementById('inAppModeBtn').classList.remove('active');
      });

      document.getElementById('inAppSendModeBtn').addEventListener('click', function() {
        document.getElementById('inAppSendMode').classList.remove('hidden');
        document.getElementById('withdrawMode').classList.add('hidden');
        this.classList.add('active');
        document.getElementById('withdrawModeBtn').classList.remove('active');
      });

      document.getElementById('withdrawModeBtn').addEventListener('click', function() {
        document.getElementById('inAppSendMode').classList.add('hidden');
        document.getElementById('withdrawMode').classList.remove('hidden');
        this.classList.add('active');
        document.getElementById('inAppSendModeBtn').classList.remove('active');
      });

      // Main action buttons
      document.getElementById('mainSendBtn').addEventListener('click', function() {
        navigateTo('depositPage');
      });

      document.getElementById('mainReceiveBtn').addEventListener('click', function() {
        navigateTo('withdrawPage');
      });

      // Mobile menu button
      document.getElementById('mobileMenuBtn').addEventListener('click', function() {
        navigateTo('menuPage');
      });

      // Auth state observer
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          currentUser = user;
          
          // Check if user is approved
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            
            if (!userData.approved) {
              showAlert("Account Pending", "Your account is pending admin approval. You will be notified once approved.", "warning");
              await signOut(auth);
              return;
            }
            
            // User is approved, show dashboard
            navigateTo('dashboardPage');
            updateDashboard();
            
            // Real-time updates
            const userRef = doc(db, "users", user.uid);
            onSnapshot(userRef, (doc) => {
              if (doc.exists()) {
                updateDashboard();
              }
            });
          }
        } else {
          currentUser = null;
          userData = null;
          navigateTo('authPage');
        }
      });
    });
  </script>
</body>
</html>